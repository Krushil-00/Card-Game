<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teen Patti Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card {
            width: 100px;
            height: 150px;
            perspective: 1000px;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            background: white;
            border-radius: 10px;
        }

        /* .active-player-card:hover .card-inner {
            transform: rotateY(180deg);
        } */
        .card.seen:hover .card-inner {
            transform: rotateY(180deg);
            /* background: white; */
            /* border-radius: 10px; */
        }

        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
        }

        .card-front {
            background-color: white;
            color: black;
            transform: rotateY(180deg);
            flex-direction: column;
        }

        .card-back {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            font-weight: bold;
        }

        .card-back.seen {
            background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%);
        }

        .hearts,
        .diamonds {
            color: red;
        }

        .clubs,
        .spades {
            color: black;
        }

        .timer-progress {
            /* stroke-dasharray: 283;
            stroke-dashoffset: 283; */
            animation: timer 30s linear forwards;
        }

        @keyframes timer {
            to {
                stroke-dashoffset: 0;
            }
        }

        .table-felt {
            background: linear-gradient(135deg, #059669 0%, #065f46 100%);
        }
    </style>
</head>

<body class="bg-green-900 text-white">
    <div class="container mx-auto px-4 py-8">
        <!-- Game Setup -->
        <div id="setup-screen" class="bg-gray-800 rounded-lg p-6 mb-8 max-w-md mx-auto">
            <h2 class="text-2xl font-bold mb-4 text-center">Game Setup</h2>
            <div class="mb-4">
                <label class="block mb-2">Number of Players (2-17):</label>
                <input type="number" id="player-count" min="2" max="17" value="4"
                    class="w-full px-4 py-2 rounded bg-gray-700 text-white">
            </div>
            <div class="mb-6">
                <label class="block mb-2">Starting Amount (10K-214Cr):</label>
                <input type="number" id="starting-amount" min="10000" max="2140000000" value="100000"
                    class="w-full px-4 py-2 rounded bg-gray-700 text-white">
            </div>
            <button id="start-game" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Start Game
            </button>

            <!-- Add this button after the start game button -->
            <button id="game-info-btn"
                class="w-full mt-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                Game Info & Rules
            </button>

            <!-- Add this modal div at the bottom of the setup-screen div -->
            <div id="game-info-modal"
                class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="bg-gray-800 rounded-lg p-6 max-w-md mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Game Information & Rules</h3>
                        <button id="close-info-modal" class="text-white hover:text-gray-300 text-2xl">&times;</button>
                    </div>

                    <div class="mb-6">
                        <h4 class="font-bold mb-2">Information:</h4>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>Enter total players number who will play (2-17)</li>
                            <li>Enter amount that each player will start with (10K-214Cr)</li>
                            <li>Blue card back means player has not seen the card</li>
                            <li>Red card back means player has seen the card (hover to view)</li>
                            <li>Player who is packed is not shown in the Player Container Section</li>
                            <li>Indirectly consider that player do Chal when card colour is red; and blue if player is on Blind</li>
                        </ul>
                    </div>

                    <div>
                        <h4 class="font-bold mb-2">Teen Patti Rules:</h4>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>Number of Players: 3 to 6 players (can be more in informal games).</li>
                            <li>Deck Used: Standard 52-card deck (no jokers).</li>
                            <li>Objective: Have the best 3-card hand or make others fold to win the pot.</li>
                            <br />
                            <li>Ante (Boot Amount): All players contribute an initial bet (called boot amount) to form the pot.(Depends on the amounteach player have)</li>
                            <li>Dealing: Each player gets 3 cards face-down.</li>
                            <li>
                                Dealing: Each player gets 3 cards face-down.
                                <ul class="list-[circle] pl-5 space-y-1">
                                    <li>Trail (Set/Trio) – Three cards of the same rank<br />(e.g., A♠ A♥ A♦)</li>
                                    <li>Pure Sequence (Straight Flush) – Three consecutive cards of the same suit<br />(e.g., 7♦ 8♦ 9♦)</li>
                                    <li>Sequence (Straight) – Three consecutive cards, not all same suit<br />(e.g., 5♠ 6♥ 7♦)</li>
                                    <li>Color (Flush) – Three cards of the same suit, not in sequence<br />(e.g., K♥ 5♥ 9♥)</li>
                                    <li>Pair – Two cards of the same rank<br />(e.g., Q♠ Q♥ 4♦)</li>
                                    <li>High Card – No combination; highest card compared<br />(e.g., A♠ 8♦ 3♥)</li>
                                </ul>
                            </li>
                            <br/>
                            <li>Players take turns to Chal, Blind, Show, or Pack.</li>
                            <li>Betting can be clockwise or anti-clockwise (decided before the game).</li>
                            <li>If all but one player folds, the remaining player wins the pot.</li>
                            <br />
                            <li>If two or more players remain till the end, they show their cards, and the best hand wins.</li>
                            <li>If hands are equal, the player who didn’t ask for the showdown wins.</li>
                            <br />
                            <li>Blind Play: A player can choose to play blind (without seeing cards) and bet half the amount.</li>
                            <li>Chaal (Seen Play): A player who has seen their cards must bet at least the current stake.</li>
                            <br />
                            <li>The last remaining player or the one with the best hand wins the pot.</li>
                            <li>If all players fold except one, that player wins without showing cards.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Board -->
        <div id="game-board" class="hidden">

            <!-- Player Areas -->
            <div id="players-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8"></div>

            <!-- Game Info -->
            <div class="flex flex-col justify-between items-center mb-6">
                <div class="bg-gray-800 px-4 py-2 m-2 rounded-lg">
                    <span class="font-semibold">Round:</span> <span id="round-number">1</span>
                </div>
                <div class="bg-blue-900 px-4 py-2 rounded-lg text-center">
                    <div class="font-bold text-lg">POT: ₹<span id="pot">0</span></div>
                    <div class="text-sm">Current Chal: ₹<span id="current-chal">0</span></div>
                </div>

            </div>

            <!-- Current Player Actions -->
            <div id="current-player-area" class="bg-gray-800 rounded-lg p-6 mb-8">
                <div class="flex justify-between">
                    <h2 class="text-2xl font-bold mb-4">Your Turn: <span id="current-player-name">Player 1</span></h2>
                    <div class="relative w-12 h-12">
                        <svg class="w-full h-full" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#374151" stroke-width="8" />
                            <circle id="timer-circle" cx="50" cy="50" r="45" fill="none" stroke="#3b82f6"
                                stroke-width="8" stroke-linecap="round" transform="rotate(-90 50 50)"
                                class="timer-progress" />
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center font-bold" id="timer-text">30
                        </div>
                    </div>
                </div>

                <div id="view-cards-prompt" class="mb-4 hidden">
                    <p class="text-center mb-2">Would you like to see your cards?</p>
                    <div class="flex justify-center gap-4">
                        <button id="view-cards-yes"
                            class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">Yes</button>
                        <button id="view-cards-no" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg">No</button>
                    </div>
                </div>

                <div class="flex flex-wrap justify-center gap-4 mb-6 active-player-card transform -scale-x-100"
                    id="current-player-cards">
                </div>

                <div class="mb-4">
                    <p class="mb-2">Your Balance: ₹<span id="current-balance">0</span></p>
                    <p class="mb-4">Round: <span id="current-round">1</span>/4</p>
                </div>

                <div id="action-buttons" class="hidden grid grid-cols-2 gap-3">
                    <button id="half-blind-btn"
                        class="bg-yellow-600 hover:bg-yellow-700 px-6 py-2 rounded-lg font-bold">2/ BLIND (₹<span
                            id="half-blind-amount">0</span>)
                    </button>
                    <button id="blind-btn"
                        class="bg-yellow-600 hover:bg-yellow-700 px-6 py-2 rounded-lg font-bold">BLIND (₹<span
                            id="blind-amount">0</span>)
                    </button>
                    <button id="double-blind-btn"
                        class="bg-yellow-700 hover:bg-yellow-800 px-6 py-2 rounded-lg font-bold">2× BLIND (₹<span
                            id="double-blind-amount">0</span>)
                    </button>
                    <button id="chal-btn" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg font-bold">CHAL
                        (₹<span id="chal-amount">0</span>)
                    </button>
                    <button id="double-chal-btn" class="bg-blue-700 hover:bg-blue-800 px-6 py-2 rounded-lg font-bold">2×
                        CHAL (₹<span id="double-chal-amount">0</span>)
                    </button>
                    <button id="pack-btn" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded-lg font-bold">PACK
                    </button>
                    <button id="show-btn" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg font-bold">SHOW
                    </button>
                </div>
            </div>

            <!-- Game Log -->
            <div class="bg-black bg-opacity-50 p-4 rounded-lg">
                <h2 class="text-xl mb-2">Game Log:</h2>
                <div id="game-log" class="h-48 overflow-y-auto"></div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="hidden max-w-md mx-auto bg-gray-800 rounded-xl shadow-lg p-6 text-center">
            <h2 class="text-2xl font-bold mb-4" id="winner-text">Player 1 Wins!</h2>
            <div class="mb-6" id="winner-cards"></div>
            <div class="flex flex-col gap-3">
                <button id="continue-game-btn"
                    class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg">
                    Continue Playing
                </button>
                <button id="new-game-btn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg">
                    New Game
                </button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            players: [],
            deck: [],
            distributedCards: [],
            currentPlayerIndex: 0,
            round: 1,
            pot: 0,
            currentChal: 0,
            initialChal: 0,
            firstChal: 0,
            potLimit: 0,
            timer: null,
            whatLastDone: 'a',
            whatCurrDone: 'a',
            timeLeft: 30,
            hasSeenCards: [],
            isBlind: [],
            activePlayers: [],
            gamePhase: 'setup'
        };

        // DOM Elements
        const setupScreen = document.getElementById('setup-screen');
        const gameBoard = document.getElementById('game-board');
        const gameOverScreen = document.getElementById('game-over-screen');
        const playerCountInput = document.getElementById('player-count');
        const startingAmountInput = document.getElementById('starting-amount');
        const startGameBtn = document.getElementById('start-game');
        const playersContainer = document.getElementById('players-container');
        const viewCardsPrompt = document.getElementById('view-cards-prompt');
        const viewCardsYes = document.getElementById('view-cards-yes');
        const viewCardsNo = document.getElementById('view-cards-no');
        const actionButtons = document.getElementById('action-buttons');
        const halfBlindBtn = document.getElementById('half-blind-btn');
        const blindBtn = document.getElementById('blind-btn');
        const doubleBlindBtn = document.getElementById('double-blind-btn');
        const chalBtn = document.getElementById('chal-btn');
        const doubleChalBtn = document.getElementById('double-chal-btn');
        const packBtn = document.getElementById('pack-btn');
        const showBtn = document.getElementById('show-btn');
        const roundNumber = document.getElementById('round-number');
        const potDisplay = document.getElementById('pot');
        const currentChalDisplay = document.getElementById('current-chal');
        const timerText = document.getElementById('timer-text');
        const winnerText = document.getElementById('winner-text');
        const winnerCards = document.getElementById('winner-cards');
        const continueGameBtn = document.getElementById('continue-game-btn');
        const newGameBtn = document.getElementById('new-game-btn');
        const currentPlayerName = document.getElementById('current-player-name');
        const currentPlayerCards = document.getElementById('current-player-cards');
        const currentBalance = document.getElementById('current-balance');
        const currentRound = document.getElementById('current-round');
        const gameLog = document.getElementById('game-log');

        // Card Constants
        const SUITS = {
            17: { symbol: '♠', class: 'spades' },
            18: { symbol: '♦', class: 'diamonds' },
            19: { symbol: '♥', class: 'hearts' },
            20: { symbol: '♣', class: 'clubs' }
        };

        const RANKS = {
            2: '2', 3: '3', 4: '4', 5: '5', 6: '6', 7: '7', 8: '8', 9: '9',
            10: '10', 11: 'J', 12: 'Q', 13: 'K', 14: 'A'
        };

        // Game Info Modal
        const gameInfoBtn = document.getElementById('game-info-btn');
        const gameInfoModal = document.getElementById('game-info-modal');
        const closeInfoModal = document.getElementById('close-info-modal');

        gameInfoBtn.addEventListener('click', () => {
            gameInfoModal.classList.remove('hidden');
        });

        closeInfoModal.addEventListener('click', () => {
            gameInfoModal.classList.add('hidden');
        });

        // Close modal when clicking outside
        gameInfoModal.addEventListener('click', (e) => {
            if (e.target === gameInfoModal) {
                gameInfoModal.classList.add('hidden');
            }
        });

        // Initialize Game
        function initGame() {
            const playerCount = parseInt(playerCountInput.value);
            const startingAmount = parseInt(startingAmountInput.value);

            if (playerCount < 2 || playerCount > 17 || isNaN(playerCount)) {
                alert('Please enter number of players between 2 and 17');
                return;
            }

            if (startingAmount < 10000 || startingAmount > 2140000000 || isNaN(startingAmount)) {
                alert('Please enter amount between 10K and 214Cr');
                return;
            }

            gameLog.innerHTML = '';

            // Initialize game state
            gameState.players = Array(playerCount).fill().map((_, i) => ({
                id: i + 1,
                name: `Player ${i + 1}`,
                money: startingAmount,
                cards: [],
                isActive: true
            }));

            gameState.hasSeenCards = Array(playerCount).fill(false);
            gameState.isBlind = Array(playerCount).fill(false);
            gameState.activePlayers = Array(playerCount).fill(true);
            gameState.currentPlayerIndex = 0;
            gameState.round = 1;
            gameState.initialChal = Math.ceil(startingAmount * 0.02);
            gameState.currentChal = gameState.initialChal;
            gameState.firstChal = gameState.initialChal;
            gameState.pot = playerCount * gameState.currentChal;
            gameState.potLimit = Math.ceil(playerCount * startingAmount / 2);
            gameState.timeLeft = 30;

            // Initialize deck and distribute cards
            initializeDeck();
            shuffleDeck();
            distributeCards();

            // Update UI
            updateGameUI();
            setupScreen.classList.add('hidden');
            gameBoard.classList.remove('hidden');

            // Start first turn
            startPlayerTurn();
        }

        // Initialize Deck
        function initializeDeck() {
            gameState.deck = [];
            const suits = [17, 18, 19, 20]; // S, D, H, C
            const ranks = [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14];

            for (let suit of suits) {
                for (let rank of ranks) {
                    gameState.deck.push([rank, suit]);
                }
            }
        }

        // Shuffle Deck
        function shuffleDeck() {
            for (let i = gameState.deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [gameState.deck[i], gameState.deck[j]] = [gameState.deck[j], gameState.deck[i]];
            }
        }

        // Distribute Cards
        function distributeCards() {
            gameState.distributedCards = [];
            let cardIndex = 0;

            for (let i = 0; i < 3; i++) {
                gameState.distributedCards[i] = [];
                for (let j = 0; j < gameState.players.length; j++) {
                    gameState.distributedCards[i][j] = gameState.deck[cardIndex++];
                }
            }
        }

        // Update Game UI
        function updateGameUI() {
            // Update game info
            roundNumber.textContent = gameState.round;
            potDisplay.textContent = gameState.pot.toLocaleString('en-IN');
            currentChalDisplay.textContent = gameState.currentChal.toLocaleString('en-IN');

            // Update players display
            playersContainer.innerHTML = '';
            gameState.players.forEach((player, index) => {
                if (!gameState.activePlayers[index]) return;

                const playerEl = document.createElement('div');
                playerEl.className = `bg-gray-700 rounded-lg p-3 ${index === gameState.currentPlayerIndex ? 'ring-2 ring-yellow-400' : ''}`;

                const playerHeader = document.createElement('div');
                playerHeader.className = 'flex justify-between items-center mb-2';
                playerHeader.innerHTML = `
                    <span class="font-bold">${player.name}</span>
                    <span class="bg-gray-600 px-2 py-1 rounded">₹${player.money.toLocaleString('en-IN')}</span>
                `;
                playerEl.appendChild(playerHeader);

                const cardsContainer = document.createElement('div');
                cardsContainer.className = 'flex justify-center gap-1';

                // Display player's cards
                for (let i = 0; i < 3; i++) {
                    const cardEl = document.createElement('div');
                    cardEl.className = 'card';

                    const cardInner = document.createElement('div');
                    cardInner.className = 'card-inner';

                    const cardBack = document.createElement('div');
                    cardBack.className = `card-back ${gameState.hasSeenCards[index] ? 'seen' : ''}`;
                    cardBack.innerHTML = gameState.hasSeenCards[index] ? '🔴' : '🔵';
                    cardInner.appendChild(cardBack);

                    const cardFace = document.createElement('div');
                    cardFace.className = 'card-face';

                    if (gameState.distributedCards[i] && gameState.distributedCards[i][index]) {
                        const [number, shape] = gameState.distributedCards[i][index];
                        const color = shape === 19 || shape === 18 ? 'text-red-600' : 'text-black';

                        cardFace.innerHTML = `
                            <div class="text-lg font-bold ${color}">${RANKS[number]}</div>
                            <div class="text-2xl ${color}">${SUITS[shape].symbol}</div>
                        `;
                    }

                    cardInner.appendChild(cardFace);
                    cardEl.appendChild(cardInner);
                    cardsContainer.appendChild(cardEl);
                }
                playerEl.appendChild(cardsContainer);
                playersContainer.appendChild(playerEl);
            });

            // Update current player's cards
            currentPlayerCards.innerHTML = '';
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            currentPlayerName.textContent = currentPlayer.name;
            currentBalance.textContent = currentPlayer.money.toLocaleString('en-IN');
            currentRound.textContent = gameState.round;

            for (let i = 0; i < 3; i++) {
                const cardEl = document.createElement('div');
                // Only add 'seen' class if player has seen cards
                cardEl.className = `card ${gameState.hasSeenCards[gameState.currentPlayerIndex] ? 'seen' : ''}`;

                const cardInner = document.createElement('div');
                cardInner.className = 'card-inner';

                const cardBack = document.createElement('div');
                cardBack.className = `card-back ${gameState.hasSeenCards[gameState.currentPlayerIndex] ? 'seen' : ''}`;
                cardBack.innerHTML = gameState.hasSeenCards[gameState.currentPlayerIndex] ? '🔴' : '🔵';
                cardInner.appendChild(cardBack);

                const cardFace = document.createElement('div');
                cardFace.className = 'card-face';

                if (gameState.distributedCards[i] && gameState.distributedCards[i][gameState.currentPlayerIndex]) {
                    const [number, shape] = gameState.distributedCards[i][gameState.currentPlayerIndex];
                    const color = shape === 19 || shape === 18 ? 'text-red-600' : 'text-black';

                    cardFace.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full">
                            <div class="text-lg font-bold ${color}">${RANKS[number]}</div>
                            <div class="text-2xl ${color}">${SUITS[shape].symbol}</div>
                        </div>
                    `;
                }

                cardInner.appendChild(cardFace);
                cardEl.appendChild(cardInner);
                currentPlayerCards.appendChild(cardEl);
            }

            // Update action buttons
            document.getElementById('blind-amount').textContent = gameState.currentChal.toLocaleString('en-IN');
            document.getElementById('half-blind-amount').textContent = Math.floor(gameState.currentChal / 2).toLocaleString('en-IN');

            if (gameState.whatLastDone === 'b' || gameState.whatLastDone === 'db' /* || gameState.whatLastDone === 'h' */) {
                gameState.currentChal *= 2;
                document.getElementById('chal-amount').textContent = gameState.currentChal.toLocaleString('en-IN');
                currentChalDisplay.textContent = gameState.currentChal.toLocaleString('en-IN');
                gameState.currentChal /= 2;
            } else {
                document.getElementById('chal-amount').textContent = gameState.currentChal.toLocaleString('en-IN');
            }

            gameState.currentChal *= 2;
            document.getElementById('double-blind-amount').textContent = gameState.currentChal.toLocaleString('en-IN');
            if (gameState.whatLastDone === 'b' || gameState.whatLastDone === 'db' /* || gameState.whatLastDone === 'h' */) {
                gameState.currentChal *= 2;
                document.getElementById('double-chal-amount').textContent = gameState.currentChal.toLocaleString('en-IN');
                gameState.currentChal /= 2;
            } else {
                document.getElementById('double-chal-amount').textContent = gameState.currentChal.toLocaleString('en-IN');
            }
            gameState.currentChal /= 2;

            // Show/hide half-blind button based on conditions
            const showHalfBlind = gameState.firstChal < gameState.currentChal && (gameState.whatLastDone === 'c' || gameState.whatLastDone === 'h') && !gameState.hasSeenCards[gameState.currentPlayerIndex];
            halfBlindBtn.classList.toggle('hidden', !showHalfBlind);

            // Disable show button if not exactly 2 players remaining
            const activePlayersCount = gameState.activePlayers.filter(Boolean).length;
            showBtn.disabled = activePlayersCount !== 2;
        }

        // Start Player Turn
        function startPlayerTurn() {
            // Reset timer
            resetTimer();

            // Check if game should end
            const activePlayersCount = gameState.activePlayers.filter(Boolean).length;
            if (activePlayersCount === 1 || gameState.round > 4 || gameState.pot >= gameState.potLimit) {
                endGame();
                return;
            }

            // Find next active player
            while (!gameState.activePlayers[gameState.currentPlayerIndex]) {
                gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
                if (gameState.currentPlayerIndex === 0) {
                    gameState.round++;
                }
            }

            updateGameUI();

            // Show view cards prompt if player hasn't seen cards
            if (!gameState.hasSeenCards[gameState.currentPlayerIndex]) {
                viewCardsPrompt.classList.remove('hidden');
                actionButtons.classList.add('hidden');
            } else {
                viewCardsPrompt.classList.add('hidden');
                actionButtons.classList.remove('hidden');

                // Show appropriate buttons - never show half-blind if seen cards
                halfBlindBtn.classList.add('hidden'); // Always hide half-blind if seen cards
                blindBtn.classList.add('hidden'); // Never show blind if seen cards
                doubleBlindBtn.classList.add('hidden');
                chalBtn.classList.remove('hidden');
                doubleChalBtn.classList.remove('hidden');
            }
        }

        // Player Actions
        function playerAction(action) {
            const player = gameState.players[gameState.currentPlayerIndex];
            let nextPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;

            // Find next active player
            while (!gameState.activePlayers[nextPlayerIndex] && nextPlayerIndex !== gameState.currentPlayerIndex) {
                nextPlayerIndex = (nextPlayerIndex + 1) % gameState.players.length;
            }

            switch (action) {
                case 'halfBlind':
                    if (player.money >= Math.floor(gameState.currentChal / 2)) {
                        const halfBlindAmount = Math.floor(gameState.currentChal / 2);
                        player.money -= halfBlindAmount;
                        gameState.pot += halfBlindAmount;
                        gameState.isBlind[gameState.currentPlayerIndex] = true;
                        gameState.whatLastDone = 'h';
                        addToLog(`${player.name} played HALF BLIND (₹${halfBlindAmount})`);
                    } else {
                        alert("You don't have enough money for half blind!");
                        return;
                    }
                    break;

                case 'blind':
                    if (player.money >= gameState.currentChal) {
                        player.money -= gameState.currentChal;
                        gameState.pot += gameState.currentChal;
                        gameState.isBlind[gameState.currentPlayerIndex] = true;
                        gameState.whatLastDone = 'b';
                        currentChalDisplay.textContent = gameState.currentChal.toLocaleString('en-IN');
                        addToLog(`${player.name} played BLIND (₹${gameState.currentChal})`);
                    } else {
                        alert("You don't have enough money for blind chal!");
                        return;
                    }
                    break;

                case 'doubleBlind':
                    if (player.money >= gameState.currentChal * 2) {
                        player.money -= gameState.currentChal * 2;
                        gameState.pot += gameState.currentChal * 2;
                        gameState.currentChal = gameState.currentChal * 2;
                        gameState.isBlind[gameState.currentPlayerIndex] = true;
                        gameState.whatLastDone = 'db';
                        currentChalDisplay.textContent = gameState.currentChal.toLocaleString('en-IN');
                        addToLog(`${player.name} played DOUBLE BLIND (₹${gameState.currentChal})`);
                    } else {
                        alert("You don't have enough money for double blind chal!");
                        return;
                    }
                    break;

                case 'chal':
                    if (gameState.whatLastDone == 'b' || gameState.whatLastDone == 'db' /* || gameState.whatLastDone == 'h' */) {
                        gameState.currentChal *= 2;
                    }
                    if (player.money >= gameState.currentChal) {
                        player.money -= gameState.currentChal;
                        gameState.pot += gameState.currentChal;
                        gameState.whatLastDone = 'c';
                        currentChalDisplay.textContent = gameState.currentChal.toLocaleString('en-IN');
                        addToLog(`${player.name} played CHAL (₹${gameState.currentChal})`);
                    } else {
                        alert("You don't have enough money for chal!");
                        if (gameState.whatLastDone == 'b') {
                            gameState.currentChal /= 2;
                        }
                        return;
                    }
                    break;

                case 'doubleChal':
                    if (gameState.whatLastDone == 'b' || gameState.whatLastDone == 'db' /* || gameState.whatLastDone == 'h' */) {
                        gameState.currentChal *= 2;
                    }
                    if (player.money >= gameState.currentChal * 2) {
                        player.money -= gameState.currentChal * 2;
                        gameState.pot += gameState.currentChal * 2;
                        gameState.currentChal *= 2;
                        gameState.whatLastDone = 'c';
                        currentChalDisplay.textContent = gameState.currentChal.toLocaleString('en-IN');
                        addToLog(`${player.name} played DOUBLE CHAL (₹${gameState.currentChal})`);
                    } else {
                        alert("You don't have enough money for double chal!");
                        if (gameState.whatLastDone == 'b') {
                            gameState.currentChal /= 2;
                        }
                        return;
                    }
                    break;

                case 'pack':
                    gameState.activePlayers[gameState.currentPlayerIndex] = false;
                    addToLog(`${player.name} PACKED and is out of the game`);
                    if (gameState.whatLastDone === 'b' && gameState.whatCurrDone === 'n') {
                        gameState.currentChal /= 2;
                    }
                    currentChalDisplay.textContent = gameState.currentChal.toLocaleString('en-IN');
                    // gameState.whatLastDone = 'p';
                    break;

                case 'show':
                    if (gameState.activePlayers.filter(Boolean).length === 2 && player.money >= gameState.currentChal) {
                        player.money -= gameState.currentChal;
                        gameState.pot += gameState.currentChal;
                        addToLog(`${player.name} called SHOW (₹${gameState.currentChal})`);
                        endGame();
                        return;
                    }
                    break;
            }

            // Move to next player
            gameState.currentPlayerIndex = nextPlayerIndex;

            // Check if round is over (all players have had their turn)
            if (gameState.currentPlayerIndex === 0) {
                gameState.round++;
            }

            startPlayerTurn();
        }

        // End Game
        function endGame() {
            clearInterval(gameState.timer);

            // Determine winner
            const activePlayers = gameState.players.filter((_, index) => gameState.activePlayers[index]);

            if (activePlayers.length === 1) {
                // Only one player left
                const winner = activePlayers[0];
                winner.money += gameState.pot;

                winnerText.textContent = `${winner.name} Wins!`;
                winnerCards.innerHTML = `
                    <div class="flex justify-center gap-2 mb-4">
                        ${gameState.distributedCards.map((_, i) => {
                    const [number, shape] = gameState.distributedCards[i][winner.id - 1];
                    const color = shape === 19 || shape === 18 ? 'text-red-600' : 'text-black';
                    return `
                                <div class="bg-white rounded-md w-16 h-24 flex flex-col items-center justify-center p-1">
                                    <div class="text-lg font-bold ${color}">${RANKS[number]}</div>
                                    <div class="text-2xl ${color}">${SUITS[shape].symbol}</div>
                                </div>
                            `;
                }).join('')}
                    </div>
                    <div class="text-xl">Won ₹${gameState.pot.toLocaleString('en-IN')}</div>
                `;
            } else {
                // Compare cards of remaining players
                const winner = compareHands(activePlayers);
                winner.money += gameState.pot;

                winnerText.textContent = `${winner.name} Wins!`;
                winnerCards.innerHTML = `
                    <div class="flex justify-center gap-2 mb-4">
                        ${gameState.distributedCards.map((_, i) => {
                    const [number, shape] = gameState.distributedCards[i][winner.id - 1];
                    const color = shape === 19 || shape === 18 ? 'text-red-600' : 'text-black';
                    return `
                                <div class="bg-white rounded-md w-16 h-24 flex flex-col items-center justify-center p-1">
                                    <div class="text-lg font-bold ${color}">${RANKS[number]}</div>
                                    <div class="text-2xl ${color}">${SUITS[shape].symbol}</div>
                                </div>
                            `;
                }).join('')}
                    </div>
                    <div class="text-xl">Won ₹${gameState.pot.toLocaleString('en-IN')}</div>
                `;
            }

            gameBoard.classList.add('hidden');
            gameOverScreen.classList.remove('hidden');
            gameState.gamePhase = 'gameOver';
        }

        // Compare hands to determine winner
        function compareHands(players) {
            // Simplified comparison - would implement full Teen Patti hand ranking in production
            // For demo purposes, just return first player
            return players[0];
        }

        // Timer Functions
        function resetTimer() {
            clearInterval(gameState.timer);
            gameState.timeLeft = 30;
            timerText.textContent = gameState.timeLeft;

            // Reset timer animation
            const timerCircle = document.getElementById('timer-circle');
            timerCircle.style.animation = 'none';
            timerCircle.offsetHeight; // Trigger reflow
            timerCircle.style.animation = 'timer 30s linear forwards';

            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                timerText.textContent = gameState.timeLeft;

                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timer);
                    // Auto fold
                    playerAction('pack');
                }
            }, 1000);
        }

        // Add message to game log
        function addToLog(message) {
            const logEntry = document.createElement('p');
            logEntry.textContent = message;
            gameLog.appendChild(logEntry);
            gameLog.scrollTop = gameLog.scrollHeight;
        }

        // Event Listeners
        startGameBtn.addEventListener('click', initGame);

        viewCardsYes.addEventListener('click', () => {
            gameState.hasSeenCards[gameState.currentPlayerIndex] = true;
            gameState.isBlind[gameState.currentPlayerIndex] = false;
            viewCardsPrompt.classList.add('hidden');
            actionButtons.classList.remove('hidden');
            chalBtn.classList.remove('hidden');
            doubleChalBtn.classList.remove('hidden');
            halfBlindBtn.classList.add('hidden');
            blindBtn.classList.add('hidden');
            doubleBlindBtn.classList.add('hidden');
            gameState.whatCurrDone = 'y';

            // Update the cards to add the 'seen' class
            const cards = currentPlayerCards.querySelectorAll('.card');
            cards.forEach(card => {
                card.classList.add('seen');
                card.querySelector('.card-back').classList.add('seen');
            });

            updateGameUI();
            addToLog(`${gameState.players[gameState.currentPlayerIndex].name} viewed their cards`);
        });

        viewCardsNo.addEventListener('click', () => {
            gameState.isBlind[gameState.currentPlayerIndex] = true;
            viewCardsPrompt.classList.add('hidden');
            actionButtons.classList.remove('hidden');
            halfBlindBtn.classList.remove('hidden');
            blindBtn.classList.remove('hidden');
            doubleBlindBtn.classList.remove('hidden');
            chalBtn.classList.add('hidden');
            doubleChalBtn.classList.add('hidden');
            gameState.whatCurrDone = 'y';
            updateGameUI();
            addToLog(`${gameState.players[gameState.currentPlayerIndex].name} chose to play blind`);
        });

        halfBlindBtn.addEventListener('click', () => playerAction('halfBlind'));
        blindBtn.addEventListener('click', () => playerAction('blind'));
        doubleBlindBtn.addEventListener('click', () => playerAction('doubleBlind'));
        chalBtn.addEventListener('click', () => playerAction('chal'));
        doubleChalBtn.addEventListener('click', () => playerAction('doubleChal'));
        packBtn.addEventListener('click', () => playerAction('pack'));
        showBtn.addEventListener('click', () => playerAction('show'));

        continueGameBtn.addEventListener('click', () => {
            // Reset for new round
            gameState.pot = 0;
            gameState.currentChal = gameState.initialChal;
            gameState.pot = gameState.players.reduce((sum, player) => {
                if (player.money >= gameState.currentChal) {
                    player.money -= gameState.currentChal;
                    return sum + gameState.currentChal;
                }
                return sum;
            }, 0);

            gameState.round = 1;
            gameState.currentPlayerIndex = 0;
            gameState.whatLastDone = 'a';
            gameState.whatCurrDone = 'a';

            // Reset seen cards and blind status for all players
            gameState.hasSeenCards = Array(gameState.players.length).fill(false);
            gameState.isBlind = Array(gameState.players.length).fill(false);

            // Reinitialize deck and cards
            initializeDeck();
            shuffleDeck();
            distributeCards();

            // Reset player states
            gameState.activePlayers = gameState.players.map(player => player.money >= gameState.currentChal);

            gameOverScreen.classList.add('hidden');
            gameBoard.classList.remove('hidden');

            addToLog('Last round is over.')
            addToLog('Continuing to next round...');

            startPlayerTurn();
        });

        newGameBtn.addEventListener('click', () => {
            gameOverScreen.classList.add('hidden');
            setupScreen.classList.remove('hidden');
        });
    </script>
</body>

</html>